<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>BDWatchdog's interface</title>
    <link href="img/favicon.ico" rel="shortcut icon" type="image/x-icon">

    <!-- JQuery -->
    <script src="https://code.jquery.com/jquery-1.10.2.js"></script>

    <!-- DateTime picker -->
    <link href="http://tarruda.github.com/bootstrap-datetimepicker/assets/css/bootstrap-datetimepicker.min.css"
          media="screen" rel="stylesheet" type="text/css">
    <script src="http://tarruda.github.com/bootstrap-datetimepicker/assets/js/bootstrap-datetimepicker.min.js"></script>

    <!-- Bootstrap -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" rel="stylesheet">

    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

    <!-- Canvas converter -->
    <!--<script src="http://canvg.github.io/canvg/rgbcolor.js" type="text/javascript"></script>-->
    <!--<script src="http://canvg.github.io/canvg/StackBlur.js" type="text/javascript"></script>-->
    <!--<script src="http://canvg.github.io/canvg/canvg.js" type="text/javascript"></script>-->

    <!-- D3 -->
    <script src="http://mbostock.github.com/d3/d3.v2.js"></script>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-tip/0.6.7/d3-tip.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/countdown/2.6.0/countdown.min.js"></script>

    <!-- Metrics timeseries graphs -->
    <script src="app/monitoring/dynamicChartD3_3v.js" type="module"></script>
    <script src="https://cdn.jsdelivr.net/interact.js/1.2.6/interact.min.js"></script>

    <!-- FlameGraphs -->
    <link rel="stylesheet" href="css/d3-flame-graph.css"/>
    <script src="app/profiling/d3-flame-graph.js"></script>

    <!-- My Javascript -->
    <script type="text/javascript">
        window.addEventListener("load", windowLoadHandler, false);

        function windowLoadHandler() {
            let propagateAppsTimesButton = document.getElementById("propagateAppsTimesButton");
            propagateAppsTimesButton.disabled = true;

            let pickAppButton = document.getElementById("pickAppButton");
            pickAppButton.disabled = true;

            let propagateExperimentsTimesButton = document.getElementById("propagateExperimentsTimesButton");
            propagateExperimentsTimesButton.disabled = true
        }

        window.onerror = function (message, source, lineno, colno, error) {
            let a = 0;
        }

    </script>

    <script src="./index.js" type="module">
    </script>

    <script src="app/forms.js" type="module">
    </script>
    <script src="app/graphs.js" type="module">
    </script>

    <script src="app/reporting/reports.js" type="module">
    </script>
    <script src="app/monitoring/monitorings.js" type="module">
    </script>
    <script src="app/monitoring/timeseries.js" type="module">
    </script>

    <script src="app/profiling/profilings.js" type="module">
    </script>
    <script src="app/profiling/flamegraphs.js" type="module">
    </script>

    <link href='https://fonts.googleapis.com/css?family=Pacifico' rel='stylesheet' type='text/css'>

    <!-- My CSS -->
    <link href="css/simple-sidebar.css" rel="stylesheet">
    <link href="css/styles.css" rel="stylesheet">
    <link href="css/graphs.css" rel="stylesheet">

</head>

<body>
<div id="wrapper">
    <!-- Sidebar -->
    <div id="sidebar-wrapper">
        <ul class="sidebar-nav">

            <li class="sidebar-brand">
                <div>
                    <h2 class="castellar" style="font-size: 2.5vh">BDWatchdog's interface</h2>
                    <a href="http://bdwatchdog.dec.udc.es/" style="float:left">
                        <img alt="bdwatchdow logo" src="img/bdwatchdog-icon.png" style="width:90px; height:50px;"/>
                    </a>
                    <a href="http://dante.dec.udc.es/">author: Jonatan Enes (website)</a>
                    <p style="font-size: 1.2vh;line-height: 2vh;margin-left: 1vw;">A simple interface to plot metrics
                        time series and flame graphs. This version may not be the latest, you can check out the full
                        version on <a href="https://github.com/JonatanEnes/metrics-and-profiling-viewer"
                                      style="display:initial;">GitHub</a>.</p>

                </div>
            </li>

            <li class="thick">

            <li>
                <span class="label label-default lb-lg">Global Controls</span>
                <div>

                    <div>
                        <button class="btn btn-default" onclick="addEmptyMetricsForm()">Add New Metrics Form</button>
                        <button class="btn btn-default" onclick="addNewProfilingForm()">Add New Profiling Form</button>
                    </div>

                    <hr class="thin">

                    <div>
                        <button id="reloadAllButton" class="btn btn-default" style=""
                                onclick="autoreloadAll();return false;">autoreload all
                        </button>
                        <button id="drawAllButton" class="btn btn-default" style=""
                                onclick="drawAllTimeseries();return false;">draw all
                        </button>
                    </div>

                    <hr class="thin">

                    <form class="form-inline" id="sizes_form" name="sizes_form">
                        <div>
                            <span>X size:</span>
                            <input class="" style="margin-left:1vw;max-width:15%;" name="graphX" size="4"
                                   type="number" value="700">
                            <span style="margin-left:1vw;">Y size:</span>
                            <input class="" style="margin-left:1vw;max-width:15%;" name="graphY" size="4"
                                   type="number" value="300">
                            <button class="btn btn-default" style="margin-left: 1vw;"
                                    onclick="resizeAll();return false;">Re-size All
                            </button>
                        </div>
                    </form>

                    <hr class="thin">

                    <form class="form-inline" id="experiment_picker" name="experiment_picker">
                        <p>This section is integrated with the
                            <a style="display: initial;"
                               href="https://github.com/JonatanEnes/applications-timestamps-snitch">
                                application's timestamping tool</a>
                        </p>

                        <div class="menu_div">
                            <span>Timestamping service endpoint:</span>
                            <input class="input-sm menu_item"
                                   name="endpoint"
                                   style="width:40%"
                                   type="text"
                                   value="http://dante.dec.udc.es:8080/bdwatchdog/times/">
                        </div>
                        <div class="menu_div">
                            <span>Username:</span>
                            <input class="input-sm menu_item"
                                   name="username"
                                   type="text"
                                   value="root">
                        </div>

                        <div class="dropdown menu_div">
                            <span>Experiment:</span>
                            <input class="input-sm menu_item"
                                   name="experiment"
                                   type="text"
                                   style="width:33%"
                                   value="hadoop_experiments"
                                   id="experiment_button">
                            <button class="btn btn-default dropdown-toggle menu_item"
                                    type="button"
                                    onclick="getExperiments()" data-toggle="dropdown" aria-haspopup="true"
                                    aria-expanded="true">
                                Pick
                                <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu" id="exps_timepicker_list">
                            </ul>
                            <button id="propagateExperimentsTimesButton"
                                    class="btn btn-default dropdown-toggle menu_item"
                                    type="button"
                                    onclick="getExperimentTimes()">Propagate time
                            </button>
                            <i class="fa fa-2x fa-remove" onclick="deleteExperiment()" aria-hidden="true"></i>
                        </div>

                        <div class="dropdown menu_div">
                            <span>Test:</span>
                            <input class="input-sm menu_item" name="application" type="text" value="TeraGen">
                            <button id="pickAppButton"
                                    class="btn btn-default dropdown-toggle menu_item"
                                    type="button" onclick="getApplications()"
                                    data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                                Pick
                                <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu" id="apps_timepicker_list"></ul>
                            <button id="propagateAppsTimesButton"
                                    class="btn btn-default dropdown-toggle menu_item"
                                    type="button"
                                    onclick="getApplicationTimes()">Propagate time
                            </button>
                            <i class="fa fa-2x fa-remove" onclick="deleteApplication()" aria-hidden="true"></i>
                        </div>

                    </form>

                    <hr class="thin">

                    <form class="form-inline" id="times_form" name="times_form">
                        <div id="general_start_time" style="margin-bottom: 10px">
                            <span>Start time:</span>
                            <input id="global_start_time"
                                   name="datetime0"
                                   name="time_start"
                                   style="margin-left: 4%;position: absolute;"
                                   type="text"
                                   value="2017/02/08-19:52:52">
                            <span class="add-on">
									<i data-date-icon="icon-calendar"
                                       style="margin-left: 40%;margin-top: 15px; position: absolute;"
                                       data-time-icon="icon-time"></i>
								</span>
                            <i class="fa fa-pencil fa-lg" aria-hidden="true"
                               onclick="setNowTime(this.parentNode.parentNode, 0);return false;"
                               style="margin-left: 43%; margin-top: 15px; position: absolute;cursor: pointer;">
                                Now </i>
                        </div>

                        <div id="general_end_time">
                            <span>End time:</span>
                            <input id="global_end_time"
                                   name="datetime1"
                                   name="time_end"
                                   style="margin-left:5%;position: absolute;"
                                   type="text"
                                   value="2017/02/08-21:30:11">
                            <span class="add-on">
									<i data-date-icon="icon-calendar"
                                       style="margin-left:40%;margin-top: 15px; position: absolute;"
                                       data-time-icon="icon-time"></i>
								</span>
                            <i class="fa fa-pencil fa-lg" aria-hidden="true"
                               onclick="setNowTime(this.parentNode.parentNode, 1);return false;"
                               style="margin-left:43%; margin-top: 15px; position: absolute;cursor: pointer;">
                                Now </i>
                            <button id="reTimeButton" class="btn btn-default"
                                    style="margin-left:60%;position: absolute;" onclick="retimeAll();return false;">
                                retime all
                            </button>
                        </div>

                        <script type="module">
                            import {getTodayTime, getNowTime} from "./app/forms.js"


                            $('#general_start_time').datetimepicker({
                                format: 'yyyy/MM/dd-hh:mm:ss',
                                language: 'en-GB'
                            });
                            $('#general_end_time').datetimepicker({
                                format: 'yyyy/MM/dd-hh:mm:ss',
                                language: 'en-GB'
                            });


                            let newDate = new Date();
                            let FiveMinutes = 5 * 60 * 1000;
                            let ago = newDate.getTime() - FiveMinutes;
                            let now = newDate.getTime();

                            newDate = new Date(ago);
                            document.getElementById("global_start_time").value = getTodayTime(newDate) + "-" + getNowTime(newDate);

                            newDate = new Date(now);
                            document.getElementById("global_end_time").value = getTodayTime(newDate) + "-" + getNowTime(newDate);

                        </script>
                    </form>

                    <hr class="thin">

                    <form class="form-inline" id="config_form" name="config_form">
                        <div style="margin-bottom: 10px">
                            <span>Time series endpoint:</span>
                            <input class="input" name="endpoint_OpenTSDB"
                                   style="margin-left:20px;position: absolute;width:60%" type="text"
                                   value="http://dante.dec.udc.es:8080/bdwatchdog/tsdb/">
                        </div>
                        <div>
                            <span>Flame graphs endpoint:</span>
                            <input class="input" name="endpoint_MongoDB"
                                   style="margin-left:6px;position: absolute;width:60%" type="text"
                                   value="http://localhost:5000/flamegraph/">
                        </div>
                    </form>

                    <hr class="thin">

                    <form>
                        <h3>Json template file</h3>
                        <div>
                            <input type='file' id='fileinput' style="float:left; text-indent:inherit">
                            <input type='button' class="btn btn-default" id='btnLoad' value='Load'
                                   onclick='loadFile();'>
                        </div>
                    </form>

                    <hr class="thin">

                </div>
            </li>


            <li class="thick">

            <li>
                <span class="label label-default lb-lg">Technologies</span>
                <div class="">
                    <div>
                        <a href="http://opentsdb.net/">
                            <img alt="OpenTSD header" src="img/opentsdb_header.png" style="height:50px;">
                            <span style="font-size:11px">Time series database with OpenTSDB</span>
                        </a>
                    </div>
                    <div>
                        <a href="http://mongodb.com/">
                            <img alt="MongoDB header" src="img/mongodb.png" style="height:50px;">
                            <span style="font-size:11px">Flame graphs database with MongoDB</span>
                        </a>
                    </div>
                    <div>
                        <a href="https://d3js.org/">
                            <img src="img/d3.png" style="height:50px;">
                            <span style="font-size:11px">Plots with D3</span>
                        </a>
                    </div>
                    <div>
                        <a href="http://interactjs.io//">
                            <img src="img/ijs.png" style="height:50px;">
                            <span style="font-size:11px">Interactive javascript plots with interact.js</span>
                        </a>
                    </div>
                    <div>
                        <a href="https://tarruda.github.io/bootstrap-datetimepicker/">
                            <span style="font-size:11px">Web time picker by Stefan Petre</span>
                        </a>
                    </div>
                    <div>
                        <a href="http://bl.ocks.org/bobmonteverde/2070123">
                            <span style="font-size:11px">Plot's based on Bob Monteverdeâ€™s "A Simple D3 Line chart with
                                Legend and Tooltips"
                            </span>
                        </a>
                    </div>
                </div>
            </li>

            <li class="thick">

            <li>
                <span class="label label-default lb-lg">Partners</span>
                <div class="">
                    <a href="http://gac.udc.es/english/">
                        <img alt="logo gac" src="img/logogac.png" style="width:200px; height:50px;">
                    </a>
                    <a href="http://www.udc.es/index.html?language=en">
                        <img alt="logo udc" src="img/udclogo.png" style="width:200px; height:50px;">
                    </a>
                </div>
            </li>

            <li class="thick">

            <li>
                <span class="label label-default lb-lg">Funded by</span>
                <div class="">
                    <a class="plain" href="http://www.mineco.gob.es/">
                        <img width="250px" height="80px" alt="MINECO logo" src="img/mineco.jpg">
                    </a>
                    <hr class="thin">
                    <a class="plain" href="http://ec.europa.eu/regional_policy/en/funding/erdf/">
                        <img width="250px" height="75px" alt="FEDER logo" src="img/erdf.png">
                    </a>
                </div>
            </li>
            <li class="thick">

        </ul>

    </div>
    <!-- /#sidebar-wrapper -->


    <div class="container form-container" id="formsContainer"
         style="width: 100%;background-color: #e6ffe6;overflow: auto;"></div>

    <div>
        <a class="btn btn-danger" href="#menu-toggle" id="menu-toggle">Hide Menu</a>
        <a class="btn btn-danger" href="#forms-toggle" id="forms-toggle">Hide Forms</a>
    </div>

    <div style="margin-top: 10%;">
        <button id="drawHadoopButton"
                class="action-button yellow"
                style="width: 30vh;height: 11vh;font-size: 1.5vw;"
                onclick="drawSomething(YarnChilds_form, hadoop_example)">Just plot me some Hadoop!
        </button>
        <button id="drawSparkButton"
                class="action-button blue"
                style="width: 30vh;height: 11vh;font-size: 1.5vw;"
                onclick="drawSomething(SparkExecutors_form, spark_example)">Just plot me some Spark!
        </button>
    </div>

    <!--
        <button id="drawFlameGraphButton" class="action-button orange" style="position: absolute;left: 70%;" onclick="quick_drawFlameGraph()">Just show me a flame graph!</button>

    THIS SECTION IS CUSTOM FOR PUBLIC WEBSITE
    -->

    <div class="" id="graphsContainer" style="float:left;width: 100%;padding-left:20px;"></div>
    <div class="" id="reportsContainer" style="float:left;width: 100%;padding-left:20px;"></div>
</div>
<!-- /#wrapper -->

<!-- Menu Toggle Script -->
<script>
    $("#menu-toggle").click(function (e) {
        e.preventDefault();
        $("#wrapper").toggleClass("toggled");
        if (this.innerText === "Hide Menu")
            this.innerText = "Show Menu";
        else
            this.innerText = "Hide Menu";
    })
    $("#forms-toggle").click(function (e) {
        e.preventDefault();
        $("#formsContainer").toggleClass("toggled");
        if (this.innerText === "Hide Forms") {
            this.innerText = "Show Forms";
        } else {
            this.innerText = "Hide Forms";
        }
    })
</script>
</body>
</html>
